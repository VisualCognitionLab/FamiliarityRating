<html>
  <head>
    <title>Familiarity Rating</title>
    <script src="jspsych-6.1.0/jspsych.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-image-button-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-vsl-grid-scene.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-call-function.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-image-slider-response.js"></script>
      <script src="jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-survey-likert.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-survey-text.js"></script>
    <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    <script src="jquery-3.5.1.min.js"></script>


  </head>
  <body></body>
  <script>

    /* create timeline */
    var timeline = [];

    var id  = jsPsych.randomization.randomID(8);


    /* define welcome message trial */
    var welcome = {
      type: "html-keyboard-response",
      stimulus: "Welcome to the experiment. Press any key to begin."
    };
    timeline.push(welcome);
      
    /* define consent trail */
    var consent = {
        type: "image-button-response",
        stimulus: "mturk_consent_revised.jpg",
        choices: ["Consent & Continue"]
    }
    timeline.push(consent);

    /* define instructions trial */
    var instructions = {
      type: "html-keyboard-response",
      stimulus: "<p>In this experiment, you will see a series of face images. </p>" +
          "<p>For each image, rate how <strong>familiar</strong> it is.</p>" +
          "<p>Press any key to begin.</p>",
      post_trial_gap: 2000
    };
    timeline.push(instructions);

    var test_stimuli = [{face: "resources/face_1_resized.jpg"},
                        {face: "resources/face_103_resized.jpg"},
                        {face: "resources/face_117_resized.jpg"},
                        {face: "resources/face_122_resized.jpg"},
                        {face: "resources/face_123_resized.jpg"},
                        {face: "resources/face_124_resized.jpg"},
                        {face: "resources/face_127_resized.jpg"},
                        {face: "resources/face_130_resized.jpg"},
                        {face: "resources/face_132_resized.jpg"},
                        {face: "resources/face_135_resized.jpg"},
                        {face: "resources/face_138_resized.jpg"},
                        {face: "resources/face_139_resized.jpg"},
                        {face: "resources/face_14_resized.jpg"},
                        {face: "resources/face_162_resized.jpg"},
                        {face: "resources/face_163_resized.jpg"},
                        {face: "resources/face_164_resized.jpg"},
                        {face: "resources/face_168_resized.jpg"},
                        {face: "resources/face_172_resized.jpg"},
                        {face: "resources/face_174_resized.jpg"},
                        {face: "resources/face_176_resized.jpg"},
                        {face: "resources/face_178_resized.jpg"},
                        {face: "resources/face_18_resized.jpg"},
                        {face: "resources/face_184_resized.jpg"},
                        {face: "resources/face_187_resized.jpg"},
                        {face: "resources/face_192_resized.jpg"},
                        {face: "resources/face_197_resized.jpg"},
                        {face: "resources/face_198_resized.jpg"},
                        {face: "resources/face_200_resized.jpg"},
                        {face: "resources/face_205_resized.jpg"},
                        {face: "resources/face_214_resized.jpg"},
                        {face: "resources/face_215_resized.jpg"},
                        {face: "resources/face_219_resized.jpg"},
                        {face: "resources/face_221_resized.jpg"},
                        {face: "resources/face_227_resized.jpg"},
                        {face: "resources/face_228_resized.jpg"},
                        {face: "resources/face_229_resized.jpg"},
                        {face: "resources/face_233_resized.jpg"},
                        {face: "resources/face_247_resized.jpg"},
                        {face: "resources/face_258_resized.jpg"},
                        {face: "resources/face_260_resized.jpg"},
                        {face: "resources/face_274_resized.jpg"},
                        {face: "resources/face_282_resized.jpg"},
                        {face: "resources/face_289_resized.jpg"},
                        {face: "resources/face_291_resized.jpg"},
                        {face: "resources/face_292_resized.jpg"},
                        {face: "resources/face_295_resized.jpg"},
                        {face: "resources/face_296_resized.jpg"},
                        {face: "resources/face_306_resized.jpg"},
                        {face: "resources/face_320_resized.jpg"},
                        {face: "resources/face_323_resized.jpg"},
                        {face: "resources/face_325_resized.jpg"},
                        {face: "resources/face_339_resized.jpg"},
                        {face: "resources/face_346_resized.jpg"},
                        {face: "resources/face_352_resized.jpg"},
                        {face: "resources/face_355_resized.jpg"},
                        {face: "resources/face_359_resized.jpg"},
                        {face: "resources/face_36_resized.jpg"},
                        {face: "resources/face_360_resized.jpg"},
                        {face: "resources/face_363_resized.jpg"},
                        {face: "resources/face_369_resized.jpg"},
                        {face: "resources/face_37_resized.jpg"},
                        {face: "resources/face_373_resized.jpg"},
                        {face: "resources/face_376_resized.jpg"},
                        {face: "resources/face_383_resized.jpg"},
                        {face: "resources/face_385_resized.jpg"},
                        {face: "resources/face_405_resized.jpg"},
                        {face: "resources/face_410_resized.jpg"},
                        {face: "resources/face_412_resized.jpg"},
                        {face: "resources/face_428_resized.jpg"},
                        {face: "resources/face_45_resized.jpg"},
                        {face: "resources/face_452_resized.jpg"},
                        {face: "resources/face_46_resized.jpg"},
                        {face: "resources/face_47_resized.jpg"},
                        {face: "resources/face_475_resized.jpg"},
                        {face: "resources/face_495_resized.jpg"},
                        {face: "resources/face_497_resized.jpg"},
                        {face: "resources/face_520_resized.jpg"},
                        {face: "resources/face_522_resized.jpg"},
                        {face: "resources/face_533_resized.jpg"},
                        {face: "resources/face_54_resized.jpg"},
                        {face: "resources/face_55_resized.jpg"},
                        {face: "resources/face_560_resized.jpg"},
                        {face: "resources/face_57_resized.jpg"},
                        {face: "resources/face_58_resized.jpg"},
                        {face: "resources/face_603_resized.jpg"},
                        {face: "resources/face_613_resized.jpg"},
                        {face: "resources/face_63_resized.jpg"},
                        {face: "resources/face_64_resized.jpg"},
                        {face: "resources/face_650_resized.jpg"},
                        {face: "resources/face_657_resized.jpg"},
                        {face: "resources/face_659_resized.jpg"},
                        {face: "resources/face_73_resized.jpg"},
                        {face: "resources/face_75_resized.jpg"},
                        {face: "resources/face_757_resized.jpg"},
                        {face: "resources/face_77_resized.jpg"},
                        {face: "resources/face_78_resized.jpg"},
                        {face: "resources/face_799_resized.jpg"},
                        {face: "resources/face_84_resized.jpg"},
                        {face: "resources/face_97_resized.jpg"},
                        {face: "resources/face_98_resized.jpg"},
                        {face: "resources/mickey_clayton.jpg"},
                        {face: "resources/mickey_taylor.jpg"},
                        {face: "resources/mickey_tyler.jpg"}];



    var fixation = {
      type: 'html-keyboard-response',
      stimulus: '<div style="font-size:60px;">+</div>',
      choices: jsPsych.NO_KEYS,
      trial_duration: function(){
        return jsPsych.randomization.sampleWithoutReplacement([250, 500], 1)[0];
      },
      data: {test_part: 'fixation'}
    }


    var test = {
      type: "image-slider-response",
      stimulus: jsPsych.timelineVariable('face'),
      labels: ['not at all familiar', 'extremely familiar'],
      data: {test_part: 'test', image: jsPsych.timelineVariable('face')}
    }


    var test_procedure = {
      timeline: [fixation, test],
      timeline_variables: test_stimuli,
      randomize_order: true,
      repetitions: 1
    }
    timeline.push(test_procedure);

        var survey_instructions = {
      type: "html-keyboard-response",
      stimulus: "<p><strong>Please complete the following questionnaire.</strong></p>" +
          "<p>Press any key to continue.</p>",
      post_trial_gap: 2000
    };
    timeline.push(survey_instructions);


    var scale_1 = [
      "Never",
      "Rarely",
      "Sometimes",
      "Often",
      "Always"
    ];
      
    var scale_2 = [
        "Strongly Agree",
        "Agree",
        "Not Applicable",
        "Disagree",
        "Strongly Disagree"
    ];

    var likert_page = {
      type: 'survey-likert',
      questions: [
        {prompt: "I used specific face features when rating familiarity.", name: 'specific_feats', labels: scale_1},
        {prompt: "I used the whole face when rating familiarity.", name: 'whole_face', labels: scale_1},
        {prompt: "I was likely to rate a face as more familiar when they looked like someone I know personally.", name: 'personally', labels: scale_2},
        {prompt: "I was likely to rate faces as familiar when they looked like someone famous.", name: 'celebrity', labels: scale_2},
        {prompt: "Faces in the experiment shared similar qualities.", name: 'exp_similar', labels: scale_1}
      ],
      randomize_question_order: true
    };
    timeline.push(likert_page);


    var survey_free = {
      type: 'survey-text',
      questions: [{prompt: "How would you describe 'familiarity'?", rows: 8, columns: 60},
        {prompt: "Please enter your Worker ID:", rows: 1, columns: 60},
                  {prompt: "Please enter your age:", rows: 1, columns: 4}]
    };
    timeline.push(survey_free);

    var goodbye = {
      type: "html-button-response",
      stimulus: function(){
        output = "Here is your secret code: zzi_" + id;
        output = output + "_izz <br><strong> Copy this code now, it will disappear after you click 'SUBMIT HIT'.</strong><br> Goodbye!<br><br>";
      return output;},
      choices: ["SUBMIT HIT"]
    };
    timeline.push(goodbye);


    function saveData(name, data){
      var xhr = new XMLHttpRequest();
      xhr.open('POST', 'php_setup_jspsych.php'); 
      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.send(JSON.stringify({filename: name, filedata: data}));
    }


    jsPsych.init({
      timeline: timeline,
      on_finish: function(){
        var file = "fam_" + id;
        jsPsych.data.addProperties({subject_id: id});
        saveData(file, jsPsych.data.get().csv());
      }
    });

  </script>
  </html>

<!--
By YIC
11/25/2020
-->
