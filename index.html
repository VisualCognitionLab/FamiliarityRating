<html>
  <head>
    <title>Familiarity Rating</title>
    <script src="jspsych-6.1.0/jspsych.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-image-button-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-vsl-grid-scene.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-call-function.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-image-slider-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-survey-likert.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-survey-text.js"></script>
    <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    <script src="jquery-3.5.1.min.js"></script>


  </head>
  <body></body>
  <script>

    /* create timeline */
    var timeline = [];

    var id  = jsPsych.randomization.randomID(8);


    /* define welcome message trial */
    var welcome = {
      type: "html-keyboard-response",
      stimulus: "Welcome to the experiment. Press any key to begin."
    };
    timeline.push(welcome);
      
    /* define consent trail */
    var consent = {
        type: "image-button-response",
        stimulus: "mturk_consent_revised.jpg",
        choices: ["Consent & Continue"]
    }
    timeline.push(consent);

    /* define instructions trial */
    var instructions = {
      type: "html-keyboard-response",
      stimulus: "<p>In this experiment, you will see a series of face images. </p>" +
          "<p>For each image, rate how <strong>familiar</strong> it is.</p>" +
          "<p>Press any key to begin.</p>",
      post_trial_gap: 2000
    };
    timeline.push(instructions);

    var test_stimuli = [{face: "ganfaces_final/face_64_resized.jpg"},
                        {face: "ganfaces_final/face_330_resized.jpg"},
                        {face: "ganfaces_final/face_184_resized.jpg"},
                        {face: "ganfaces_final/face_140_resized.jpg"},
                        {face: "ganfaces_final/face_283_resized.jpg"},
                        {face: "ganfaces_final/face_217_resized.jpg"},
                        {face: "ganfaces_final/face_20_resized.jpg"},
                        {face: "ganfaces_final/face_26_resized.jpg"},
                        {face: "ganfaces_final/face_24_resized.jpg"},
                        {face: "ganfaces_final/face_237_resized.jpg"},
                        {face: "ganfaces_final/face_385_resized.jpg"},
                        {face: "ganfaces_final/face_3_resized.jpg"},
                        {face: "ganfaces_final/face_188_resized.jpg"},
                        {face: "ganfaces_final/face_268_resized.jpg"},
                        {face: "ganfaces_final/face_260_resized.jpg"},
                        {face: "ganfaces_final/face_328_resized.jpg"},
                        {face: "ganfaces_final/face_98_resized.jpg"},
                        {face: "ganfaces_final/face_75_resized.jpg"},
                        {face: "ganfaces_final/face_232_resized.jpg"},
                        {face: "ganfaces_final/face_137_resized.jpg"},
                        {face: "ganfaces_final/face_50_resized.jpg"},
                        {face: "ganfaces_final/face_320_resized.jpg"},
                        {face: "ganfaces_final/face_9_resized.jpg"},
                        {face: "ganfaces_final/face_94_resized.jpg"},
                        {face: "ganfaces_final/face_324_resized.jpg"},
                        {face: "ganfaces_final/face_371_resized.jpg"},
                        {face: "ganfaces_final/face_187_resized.jpg"},
                        {face: "ganfaces_final/face_302_resized.jpg"},
                        {face: "ganfaces_final/face_139_resized.jpg"},
                        {face: "ganfaces_final/face_201_resized.jpg"},
                        {face: "ganfaces_final/face_295_resized.jpg"},
                        {face: "ganfaces_final/face_355_resized.jpg"},
                        {face: "ganfaces_final/face_122_resized.jpg"},
                        {face: "ganfaces_final/face_57_resized.jpg"},
                        {face: "ganfaces_final/face_101_resized.jpg"},
                        {face: "ganfaces_final/face_289_resized.jpg"},
                        {face: "ganfaces_final/face_370_resized.jpg"},
                        {face: "ganfaces_final/face_244_resized.jpg"},
                        {face: "ganfaces_final/face_92_resized.jpg"},
                        {face: "ganfaces_final/face_66_resized.jpg"},
                        {face: "ganfaces_final/face_382_resized.jpg"},
                        {face: "ganfaces_final/face_163_resized.jpg"},
                        {face: "ganfaces_final/face_61_resized.jpg"},
                        {face: "ganfaces_final/face_133_resized.jpg"},
                        {face: "ganfaces_final/face_193_resized.jpg"},
                        {face: "ganfaces_final/face_51_resized.jpg"},
                        {face: "ganfaces_final/face_388_resized.jpg"},
                        {face: "ganfaces_final/face_233_resized.jpg"},
                        {face: "ganfaces_final/face_279_resized.jpg"},
                        {face: "ganfaces_final/face_376_resized.jpg"},
                        {face: "ganfaces_final/face_293_resized.jpg"},
                        {face: "ganfaces_final/face_202_resized.jpg"},
                        {face: "ganfaces_final/face_341_resized.jpg"},
                        {face: "ganfaces_final/face_173_resized.jpg"},
                        {face: "ganfaces_final/face_383_resized.jpg"},
                        {face: "ganfaces_final/face_111_resized.jpg"},
                        {face: "ganfaces_final/face_310_resized.jpg"},
                        {face: "ganfaces_final/face_325_resized.jpg"},
                        {face: "ganfaces_final/face_212_resized.jpg"},
                        {face: "ganfaces_final/face_366_resized.jpg"},
                        {face: "ganfaces_final/face_339_resized.jpg"},
                        {face: "ganfaces_final/face_344_resized.jpg"},
                        {face: "ganfaces_final/face_34_resized.jpg"},
                        {face: "ganfaces_final/face_147_resized.jpg"},
                        {face: "ganfaces_final/face_135_resized.jpg"},
                        {face: "ganfaces_final/face_148_resized.jpg"},
                        {face: "ganfaces_final/face_349_resized.jpg"},
                        {face: "ganfaces_final/face_114_resized.jpg"},
                        {face: "ganfaces_final/face_393_resized.jpg"},
                        {face: "ganfaces_final/face_282_resized.jpg"},
                        {face: "ganfaces_final/face_112_resized.jpg"},
                        {face: "ganfaces_final/face_190_resized.jpg"},
                        {face: "ganfaces_final/face_359_resized.jpg"},
                        {face: "ganfaces_final/face_288_resized.jpg"},
                        {face: "ganfaces_final/face_151_resized.jpg"},
                        {face: "ganfaces_final/face_379_resized.jpg"},
                        {face: "ganfaces_final/face_45_resized.jpg"},
                        {face: "ganfaces_final/face_198_resized.jpg"},
                        {face: "ganfaces_final/face_390_resized.jpg"},
                        {face: "ganfaces_final/face_191_resized.jpg"},
                        {face: "ganfaces_final/face_127_resized.jpg"},
                        {face: "ganfaces_final/face_181_resized.jpg"},
                        {face: "ganfaces_final/face_249_resized.jpg"},
                        {face: "ganfaces_final/face_361_resized.jpg"},
                        {face: "ganfaces_final/face_54_resized.jpg"},
                        {face: "ganfaces_final/face_352_resized.jpg"},
                        {face: "ganfaces_final/face_346_resized.jpg"},
                        {face: "ganfaces_final/face_205_resized.jpg"},
                        {face: "ganfaces_final/face_360_resized.jpg"},
                        {face: "ganfaces_final/face_115_resized.jpg"},
                        {face: "ganfaces_final/face_323_resized.jpg"},
                        {face: "ganfaces_final/face_389_resized.jpg"},
                        {face: "ganfaces_final/face_368_resized.jpg"},
                        {face: "ganfaces_final/face_200_resized.jpg"},
                        {face: "ganfaces_final/face_109_resized.jpg"},
                        {face: "ganfaces_final/face_165_resized.jpg"},
                        {face: "ganfaces_final/face_28_resized.jpg"},
                        {face: "ganfaces_final/face_0_resized.jpg"},
                        {face: "ganfaces_final/face_41_resized.jpg"},
                        {face: "ganfaces_final/face_157_resized.jpg"},
                        {face: "ganfaces_final/mickey_tyler.jpg"},
                        {face: "ganfaces_final/mickey_taylor.jpg"},
                        {face: "ganfaces_final/mickey_clayton.jpg"}];



    var fixation = {
      type: 'html-keyboard-response',
      stimulus: '<div style="font-size:60px;">+</div>',
      choices: jsPsych.NO_KEYS,
      trial_duration: function(){
        return jsPsych.randomization.sampleWithoutReplacement([250, 500], 1)[0];
      },
      data: {test_part: 'fixation'}
    }


    var test = {
      type: "image-slider-response",
      stimulus: jsPsych.timelineVariable('face'),
      labels: ['not at all familiar', 'extremely familiar'],
      prompt: "<p>How familiar is this person?</p>",
      data: {test_part: 'test', image: jsPsych.timelineVariable('face')}
    }


    var test_procedure = {
      timeline: [fixation, test],
      timeline_variables: test_stimuli,
      randomize_order: true,
      repetitions: 1
    }
    timeline.push(test_procedure);

        var survey_instructions = {
      type: "html-keyboard-response",
      stimulus: "<p><strong>Please complete the following questionnaire.</strong></p>" +
          "<p>Press any key to continue.</p>",
      post_trial_gap: 2000
    };
    timeline.push(survey_instructions);


    var scale_1 = [
      "Never",
      "Rarely",
      "Sometimes",
      "Often",
      "Always"
    ];
      
    var scale_2 = [
        "Strongly Agree",
        "Agree",
        "Not Applicable",
        "Disagree",
        "Strongly Disagree"
    ];

    var likert_page = {
      type: 'survey-likert',
      questions: [
        {prompt: "I used specific face features when rating familiarity.", name: 'specific_feats', labels: scale_1},
        {prompt: "I used the whole face when rating familiarity.", name: 'whole_face', labels: scale_1},
        {prompt: "I was likely to rate a face as more familiar when they looked like someone I know personally.", name: 'personally', labels: scale_2},
        {prompt: "I was likely to rate faces as familiar when they looked like someone famous.", name: 'celebrity', labels: scale_2},
        {prompt: "Faces in the experiment shared similar qualities.", name: 'exp_similar', labels: scale_1}
      ],
      randomize_question_order: true
    };
    timeline.push(likert_page);


    var survey_free = {
      type: 'survey-text',
      questions: [{prompt: "Any other comments?", rows: 8, columns: 60},
        {prompt: "Please enter your Worker ID:", rows: 1, columns: 60},
                  {prompt: "Please enter your age:", rows: 1, columns: 4}]
    };
    timeline.push(survey_free);

    var goodbye = {
      type: "html-keyboard-response",
      stimulus: function(){
        output = "Here is your secret code: zzi_" + id;
        output = output + "_izz <br> Goodbye!";
      return output;}
    };
    timeline.push(goodbye);


    function saveData(name, data){
      var xhr = new XMLHttpRequest();
      xhr.open('POST', 'write_data.php'); 
      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.send(JSON.stringify({filename: name, filedata: data}));
    }


    jsPsych.init({
      timeline: timeline,
      on_finish: function(){
        var file = "fam_" + id;
        jsPsych.data.addProperties({subject_id: id});
        saveData(file, jsPsych.data.get().csv());
      }
    });

  </script>
  </html>

<!--
Ivette Colón 
11/22/2020
-->
